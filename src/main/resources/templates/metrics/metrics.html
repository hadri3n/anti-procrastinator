<!DOCTYPE html>

<html lang="en" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
	layout:decorator="layout">

<head th:include="fragments/headTag :: headTag"></head>
<body>
	<div layout:fragment="content" class="container">
		<h2>Metrics</h2>
		<div id="mem-pannel" class="panel panel-default">
			<div class="panel-heading">Memory</div>
	  		<div class="row panel-body">
			  	<div class="col-md-10">
					<canvas id="myChart" width="800" height="200"></canvas>
				</div>
				<div class="col-md-2">
					<fieldset>
						<legend>Legend</legend>
						<p style="color:rgb(0, 255, 0);font-weight:bold">Memory: <span id="memValue" ></span> Mo</p>
						<p style="color:rgb(255, 0, 255);font-weight:bold">Memory used: <span id="memUsedValue" ></span> Mo</p>
					</fieldset>
				</div>
			</div>
		</div>
		
		<script src="/js/smoothie.js" th:src="@{/js/smoothie.js}"></script>
		<script type="text/javascript" th:inline="javascript">
		/*<![CDATA[*/
		(function() {
            var apiUrl = /*[[@{/management/metrics/}]]*/;
            var memValue = document.getElementById("memValue");
            var memUsedValue = document.getElementById("memUsedValue");
			var loadMetrics = function() {
				// Random data
			      var line1 = new TimeSeries();
			      var line2 = new TimeSeries();
			      setInterval(function() {
						$.get( apiUrl + 'mem')
							.done(function(data) {
								var mem = data/ 1024;
								memValue.innerHTML = Math.round(mem);
								line1.append(new Date().getTime(), mem);
								$.get(apiUrl + 'mem.free')
								.done(function(data) {
									var memUsed = mem - (data / 1024);
									memUsedValue.innerHTML = Math.round(memUsed);
									line2.append(new Date().getTime(), memUsed);
							  });
						  });
						
			      }, 1000);
			      
			      var myYRangeFunction = function(range) {
			    	  var min = 0;
			    	  var max = 1;
			    	  return {min: min, max: max};
			    	};
			      
			      var smoothie = new SmoothieChart({
			    	  maxValue:100,
			    	  minValue:0, 
			    	  timestampFormatter:SmoothieChart.time,
			    	  grid: {
			    		  strokeStyle: 'rgb(100, 100, 100)',
			    		  fillStyle: 'rgb(50, 50, 50)',
			    		  lineWidth: 1,
			    		  millisPerLine: 250,
			    		  verticalSections: 6,
			    		  sharpLines:true
			    	 } 
			      });
			      smoothie.addTimeSeries(line1, { strokeStyle: 'rgb(0, 255, 0)', fillStyle: 'rgba(0, 255, 0, 0.4)', lineWidth: 3 });
			      smoothie.addTimeSeries(line2, { strokeStyle: 'rgb(255, 0, 255)', fillStyle: 'rgba(255, 0, 255, 0.3)', lineWidth: 3 });
			      smoothie.streamTo(document.getElementById("myChart"), 1000);

			};
			loadMetrics();
		})();
			
		/*]]>*/	
		</script>
	</div>

</body>

</html>